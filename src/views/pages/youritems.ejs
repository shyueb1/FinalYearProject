<% include base.ejs %>
<div class="row" style="width:98%;">
    <% if(items != ''){%>
    <% items.forEach((item)=>{ %>
    <div class="col-lg-3 col-md-6 col-sm-12" style="padding-left: 50px; padding-top: 30px;">
            <div class="card" style="width: 20rem; height: 18rem;">
                <div class="card-body">
                    <h5 class="card-title"><%= item.item_name%></h5>
                    <p class="card-text"><%= item.description.substring(0,100) %>...</p>
                    <p class="card-text">Estimated value: Â£<%= item.est_cost %></p>
                    <p class="card-text">Posted by <%= item.user_posted %> </p>
                    <p>
                        <a href="/viewoffers/<%= item.item_id %>"><button type="button" class="btn btn-outline-success btn-sm">View Offers</button></a>
                        <a href="/edit/<%= item.item_id %>"><button type="button" class="btn btn-outline-secondary btn-sm">Edit</button></a>
                        <a href="/delete/<%= item.item_id %>" onclick="verifyDeletion()"><button type="button" id="<%= item.item_id %>" class="btn btn-outline-danger btn-sm delete-item">Delete</button></a>
                    </p>
                </div>
                
            </div>
    </div>
    <% } );%>
    <% } %>
</div>
<script>
    $('.delete-item').click((e) => {
        var offerID = e.target.id;
        socket.emit('add notification', {
            type:'removed_item',
            sender:'<% user.user_name %>',
            relatedItem: offerID
        });
    });


    function verifyDeletion(){
        var result = confirm('Are you sure you want to delete this item?');
        if(!result){
            window.onbeforeunload = function(){
                return;
            };
        }
    }
</script>